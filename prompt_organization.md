# 半导体QA生成系统 - Prompt组织结构

## 系统概述

本系统分为三个主要阶段，每个阶段包含多个子步骤，各自使用不同的prompt模板。

## 三个主要阶段

### 第一阶段：文本预处理 + 质量评估
- 步骤1.1: 文本分块和预处理
- 步骤1.2: AI文本处理  
- 步骤1.3: 文本质量评估

### 第二阶段：QA生成（3-4个步骤）
- 步骤2.1: 分类问题生成
- 步骤2.2: 问题格式转换
- 步骤2.3: 问题质量评估
- 步骤2.4: 答案生成

### 第三阶段：数据增强
- 数据改写与增强

---

## 各阶段Prompt详细说明

### 第一阶段：文本预处理 + 质量评估

#### 步骤1.2: AI文本处理
**使用的Prompt ID**: 9 (通过 `parse_txt` 和 `input_text_process` 调用)

**Prompt内容** (来自 `prompts_conf.py` 的 prompt 9):
```
以下是我给你的markdown文本和图片。文本以markdown格式给出。图片在文中的位置以 <image> 表示,无关图片以 <irrelevant> 表示

markdown文本内容:

{markdown_content}

首先你需要在markdown文本中获得三个方面的信息。
1) 对图片背景的介绍:主要是对图例的解释和图片相关背景的介绍,例如图片上各个元素代表的意义和图片获取的环境,方法,拍摄的对象等
2) 提取并整理markdown 文本对图片反映现象的描述与相关的分析解释,反映的规律和可能的原因,或者能够支持结论等。
3) 和图片相关的知识。并给出相关知识的详细解释与介绍。

接着,我需要你根据这些内容生成一个和该图片有关的问题,并给出正确的答案,和答案的详细推理过程。
此数据会被用于构造QA数据集来训练多模态模型。
问题必须是选择题,答案是单选题。

问题以json的格式返回,key为question, answer, choices, reasoning,lecture,context
lecture 为解答该问题所需要的知识点
context 为回答该问题所必需的背景介绍,例如图片符号的定义,图片的来源,实验方法,实验环境等。

所以对context的描述需要全面明了,不可过分简介,否则会影响用户的理解和判断；但不能包含问题的答案和推理过程,且不可直接包含图片的描述和分析。
context的描述需要准确,完整,清晰。且要避免使用模糊的描述和解释,未经解释的专有名词,公式,符号等。
注意!!!用户回答问题时只能看到图片和问题选项,也无法看到markdown文本内容和图片的描述与分析。
所以context的描述需要全面明了,且独立于原文,使读者在阅读时不需要去对照或检索原文。

尽量给出详细的问题解答推理过程,不要过于简化。可以利用文本中的内容来生成问题答案和推理过程,但不能直接引用文本中的内容。
例如:"如文中所说......" 或者"根据文本中的描述......"等。所有的内容都需要用中文进行描述和解释,推理过程,依据的描述需要准确,完整,清晰。且要避免使用模糊的描述和解释,未经解释的专有名词,公式,符号等。
推理过程需要完整,清晰,准确。能正确的推导出问题的答案。而且推理内容需要独立于文本,使读者在阅读时不需要去对照或检索文本。
```

#### 步骤1.3: 文本质量评估
**使用的Prompt**: `score_template` (来自 `semiconductor_qa_generator.py`)

**Prompt内容**:
```
你的任务是依据以下评分规则对文本质量进行打分，并输出最终得分。评分流程如下：
1.依照每个标准依次评估文本。对每个子问题如实作答。若对某子问题答案为明确 "是"，则按标准相应加分或减分;
2.记录每个标准的累计分数，得出总分;
3.依据以下说明，将最终评估结果整理为有效的 JSON 对象。

## 评分标准：
1.标准 1：问题完整性
(1) 内容无清晰主要问题，或缺乏足够线索得出正确答案，得 0 分。
(2) 内容包含一个主要问题，且有足够线索得出正确答案，得 + 1 分。
(3) 文本体现多位作者间互动与讨论，如提出答案、评估反思答案、回应批评、修订编辑答案，得 + 1 分。
2.标准 2：问题复杂性和技术深度
(1) 内容难度为大学水平或以下，得 0 分。
(2) 内容难度为研究生水平或以上，仅领域专家能理解，得 + 1 分。
(3) 所讨论问题极具挑战性，高技能非专家花费 30 分钟上网搜索或阅读文献后，仍无法完全理解问题或给出正确答案，得 + 1 分。
3.标准 3：技术正确性和准确性
(1) 文本含显著技术错误或不准确，得 -1 分。
(2) 文本有一定技术正确性，但存在明显缺陷或遗漏（如单位错误、推导不完整），得 0 分。
(3) 文本技术正确，但有小缺陷或遗漏（如小代数错误、解释不完整），得 + 0.5 分。
(4) 文本技术高度正确，解释清晰准确（如精确定义、完整推导），得 + 0.5 分。
(5) 文本技术卓越正确，解释严格精确（如形式化证明、精确计算），得 + 1 分。
4.标准 4：思维和推理
(1) 文本无任何思维或推理迹象，得 -1 分。
(2) 文本展现一些基本思维和推理能力（如直接应用已知技术、简单分析问题），得 + 0.5 分。
(3) 文本展现一定思维和推理能力（如考虑多种解决方法、讨论不同方案权衡），得 + 0.5 分。
(4) 文本展现显著思维和推理能力（如通过多步推理链解决复杂问题、运用专业科学领域高级推理模式），得 + 1 分。
(5) 文本展现卓越思维和推理能力（如以高度创新方式解决专业领域复杂问题、结合多种推理技术对问题进行新抽象），得 + 1 分。

最终评判标准：若各项标准得分均大于零，且标准 4 得分大于等于 1 分，则该文本内容适合生成逻辑推理问题。

[文本内容的开始]
{academic_paper}
[文本内容的结束]

格式要求：只输出文本内容是否适合生成复杂推理问题，不输出任何别的内容。并且是否适合严格按照以下格式进行输出：
【是】或者【否】。不要输出为空，不要输出其他内容，输出是或否时，要带上【】符号进行输出。
```

### 第二阶段：QA生成

#### 步骤2.1: 分类问题生成
**使用的Prompt**: `prompt_template` (来自 `semiconductor_qa_generator.py`) + 分类增强提示

**基础Prompt内容**:
```
你是一位半导体显示技术领域的资深专家，擅长从技术文献中提炼核心知识点。你的职责是从论文中生成问题和相应的答案，问题和相应的答案对需要提供给资深的人员学习，问题和相应的答案的质量要高。请根据输入的学术论文内容，生成3个需要逻辑推理才能解答的高质量技术问题，请确保这些问题能够直接从论文中找到答案。这些问题将用于资深研究人员的专业能力评估，需满足以下要求：

<think>
首先，我需要仔细阅读这篇学术论文，理解其核心内容和技术要点。

让我分析论文的主要内容：
1. 识别论文讨论的核心技术问题
2. 找出涉及逻辑推理的技术原理和机制
3. 确定可以设计深度问题的关键点

接下来，我将基于以下原则设计问题：
- 问题必须基于论文内容，答案可以从论文中找到
- 问题需要逻辑推理才能解答，不能是简单的事实性问题
- 问题描述要清晰、完整、专业
- 避免使用"本文"、"论文"等自指表述
- 确保问题具有技术深度和挑战性
</think>

##【核心要求】
### 问题设计准则：
(1) 仔细通读全文，找出涉及逻辑推理的文本部分，据此设计相关问题。
(2) 问题要基于论文里的技术原理，描述务必清晰、全面、明确。问题中主语或名词的表述要精准、全面且通用。
(3) 避免在问题中引用文献或文章自定义的专有名词。利用自身半导体显示领域知识，生成通用问题，确保不读论文也能理解问题含义。
(4) 问题中的名词描述必须和论文一致，不能缩写。比如论文是 "OLED 材料"，问题不能写成 "材料"；论文是 "LTPS 器件"，问题不能写成 "器件"。
(5) 提问不能针对论文里的某个特定示例。要让顶尖科学家不读论文也能理解并回答问题。问题里不能有 "书本""论文""本文""本实验" 等类似表述。
(6) 确保生成问题完整，与论文彻底解耦，不依赖论文内容。若问题有背景信息，必须阐述清楚。
(7) 问题简洁：生成的问题要凝练、简洁。

### 问题设计的科学严谨性：
(1) 因果链：问题需呈现完整技术逻辑链，比如 "机制 A 怎样影响参数 B，进而引发现象 C"。
(2) 周密性：思考过程要科学严谨，逐步推进。保证问题及对应答案源自论文内容，且答案在论文中有详细阐述。

## 【禁止事项】
× 禁止使用"本文/本研究/本实验"等论文自指表述
× 禁止提问孤立概念（如：XX技术的定义是什么）
× 禁止超出论文技术范围的假设性问题

##【格式要求】
用中文输出。当前阶段只设计问题，不输出答案。输出问题前必须用 </think> 结束思考后在输出问题。严格按照以下格式输出你设计的问题：
[[1]] 第1个问题
[[2]] 第2个问题
[[3]] 第3个问题

[学术论文的开始]
{academic_paper}
[学术论文的结束]
```

**分类增强提示** (动态添加到基础prompt):
```
### 特定问题类型要求：
本次需要生成的是【{question_type}】类型的问题。

**类型说明**：{type_description}

**参考示例**：
1. {example_1}
2. {example_2}
3. {example_3}

**生成要求**：
1. 生成2-3个符合【{question_type}】类型特征的问题
2. 问题要体现{type_description}的特点
3. 确保问题的专业性和技术深度
4. 问题必须基于给定的学术内容，有明确的答案依据
```

问题类型定义：
- **factual** (15%): 事实型问题：获取指标、数值、性能参数等
- **comparative** (15%): 比较型问题：比较不同材料、结构或方案等
- **reasoning** (50%): 推理型问题：机制原理解释，探究某种行为或结果的原因
- **open** (20%): 开放型问题：优化建议，针对问题提出改进方法

#### 步骤2.3: 问题质量评估
**使用的Prompt**: `evaluator_template` (来自 `semiconductor_qa_generator.py`)

**Prompt内容**:
```
您是一位专家评估员，负责决定问题是否符合推理问题标准。您的评估必须结合给定文章内容和给定问题判断。

## 【评估标准】
### 因果性：
(1) 问题应展现出完整的技术逻辑链。比如，类似 "机制 A 怎样影响参数 B，最终致使现象 C 出现" 这种形式。

### 周密性：
(1) 思维过程要科学且严谨，需逐步思考。问题及对应的答案必须源于论文内容，且答案在论文中要有详细描述。

### 完整性：
(1) 问题是否全面涵盖文章相关内容的各个方面？
(2) 问题描述应简洁凝练，语义完整。
(3) 问题要与文章内容完全独立，不依赖文章也能被清晰理解，即问题需完整、自足。

[文章内容的开始]
{academic_paper}
[文章内容的结束]

[问题内容]
{academic_question}

格式要求：仅输出文本内容生成的问题是否符合标准，严格按以下格式，有且仅输出【是】或者【否】，不输出任何别的内容，不能输出为空，输出是或否时，要带上【】符号进行输出。用中文输出，严格按照以下格式进行输出：【是】或者【否】
```

#### 步骤2.4: 答案生成
**使用的Prompt**: Chain of Thought (COT) 答案生成模板

**Prompt内容**:
```
你是一名半导体显示领域的专家，你需要回答的问题是：{question}

请注意：如果问题的难度超过你的能力，你无法确定回答准确性，请输出'无法作答!'。

Context: {context}

使用上述给定的上下文，回答问题。注意：
- 首先，请提供有关如何回答问题的详细 reasoning。
- 在 reasoning 中，如果需要复制上下文中的某些句子，请将其包含在 ##begin_quote## 和 ##end_quote## 中。这意味着 ##begin_quote## 和 ##end_quote## 之外的内容不是直接从上下文中复制的。
- 结束你的回答，以 final answer 的形式 <ANSWER>: $answer，答案应该简洁。

你必须以<Reasoning>: 开头，包含 reasoning 相关的内容；以 <ANSWER>: 开头，包含答案。
```

### 第三阶段：数据增强

#### 数据改写与增强
**使用的Prompt**: `build_prompt` 函数生成的改写prompt

**默认Prompt模板**:
```
基于以下问答对，生成一个新的改写版本，保持核心内容不变但表达方式更丰富：

原始问题: {question}
原始答案: {answer}

请生成：
1. 改写后的问题（保持原意但表达更自然）
2. 改写后的答案（内容一致但表述更清晰）
3. 相关的背景知识
4. 推理过程

以JSON格式返回，包含question, answer, background, reasoning字段。
```

---

## 特殊用途Prompts

### 多模态相关Prompts

**Prompt ID 343** (用于图片相关问题生成):
```
<image>
以下是论文中和图片相关的内容

{text}

我需要你根据以上信息设计一个提示词，提示词必须是和图片相关的问题，问题是是客观题(选择题或者填空题)且和半导体相关或者光学相关
规则：
1. 需要为答案和推理过程提供足够的背景信息, 但不得直接摘录我提供的论文内容
2. 提示词需要围绕相关公理和推理过程展开
3. 题目需要有一定难度，不可以过分简单，面向人群是研究生人群
4. 问题必须要利用图片上的信息才能获得正确答案，如果发现只利用提示词就可以回答需要重新设计
5. 设计完成后判断，是否不依赖图片信息也能解答，如果可以重新设计问题

以json格式返回, 且只返回一个json对象。
json的key为: question,img,answer,reasoning

"question": 文字输入，如果是选择题,则为问题和选项的合并,例如: "根据以下问题和选项,回答问题......"
如果无法设计出问题,则在question中返回"无法设计出问题",answer和reasoning的值也为"无法设计出问题"
```

### 质量检查相关Prompts

**Prompt ID 36** (推理有效性检查):
```
问题：{question}, <image>
以上是问题的#文字部分#和#图片#

以下是推理过程
推理过程：{reasoning}

请你判断推理过程是否可以从题目的#文字部分#和#图片#中推导而来，
如果推理过程中的所有论据都能在#文字部分#和#图片#或者科学公理中找到证据，则返回 1
如果推理过程中的任一所有论据无法在#文字部分#和#图片#或者科学公理中找到依据，则返回-1。

注意哪怕答案是正确的，但只要推理过程中的所有论据有无法在#文字部分#和#图片#中找到依据或者是假设性的知识,就返回-1
```

**Prompt ID 37** (问题清晰度检查):
```
问题：{question}

以上是一个问题 和图片 <image>
判断问题和图片是否不合理缺少必要的细节和信息以回答问题
如果题目提供了足够的信息则返回 1
否则返回 -1
```

**Prompt ID 39** (答案正确性检查):
```
问题：{question}
推理过程: {reasoning}
答案: {answer}

以上是一个问题,问题图片,答案和推理过程
判断答案和推理过程是否正确
如果答案和推理过程都正确则返回 1
如果答案和推理过程存在任一一个错误则返回 -1
```

**Prompt ID 40** (难度适中性检查):
```
问题：{question}
推理过程: {reasoning}
答案: {answer}

以上是一个问题,问题图片,答案和推理过程
判断该问题是否过于简单不需要结合图片信息进行推理
如果问题过于简单不需要复杂推理过程则返回 -1
如果问题需要推理过程则返回 1
```

---

## 系统Prompt

所有模型调用都使用统一的系统prompt:
```
你是一个乐于助人的半导体显示技术领域的专家。
```